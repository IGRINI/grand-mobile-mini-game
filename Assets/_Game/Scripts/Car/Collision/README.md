# Система коллизий машины

## Описание
Система коллизий для машины без использования физики Unity. Обеспечивает:
- Столкновения с препятствиями и зданиями
- Пружинящий эффект при столкновениях
- Возможность сбивать врагов
- Минимальное использование ресурсов

## Компоненты

### Интерфейсы
- `ICollisionDetector` - детектор коллизий
- `IObstacle` - препятствие
- `ICollisionEffect` - эффект столкновения
- `IHittable` - объект, который можно сбить
- `IObstacleService` - сервис управления препятствиями

### Классы
- `CollisionDetector` - основной детектор коллизий
- `CircleObstacle` - круглое препятствие (для врагов)
- `RectangleObstacle` - прямоугольное препятствие (для зданий и машины)
- `CarCollisionEffect` - эффект столкновения для машины
- `ObstacleService` - сервис управления препятствиями

### MonoBehaviour компоненты
- `ObstacleView` - базовый компонент круглого препятствия
- `RectangleObstacleView` - базовый компонент прямоугольного препятствия
- `BuildingObstacle` - здание как прямоугольное препятствие (может получать урон)
- `HittableEnemy` - враг для отбрасывания (НЕ препятствие, отдельная система)

## Использование

### Создание препятствия (здания)
1. Создайте GameObject
2. Добавьте компонент `BuildingObstacle`
3. Настройте размер (Vector3) и смещение центра (Vector3) в инспекторе
4. Препятствие автоматически зарегистрируется в системе

### Создание врага для сбивания
1. Создайте GameObject
2. Добавьте компонент `HittableEnemy`
3. Настройте радиус, силу отбрасывания и смещение центра (Vector3)
4. Добавьте NavMeshAgent (будет отключаться при отбрасывании)
5. Враг автоматически регистрируется в системе врагов (НЕ препятствий)

### Настройка машины
В компоненте `CarView` настройте параметры:
- `collisionSize` - размер прямоугольной коллизии машины (Vector3)
- `collisionCenterOffset` - смещение центра коллизии машины (Vector3)
- `collisionRadius` - радиус для совместимости с круглыми препятствиями

## Принцип работы

1. **Две отдельные системы**:
   - Препятствия (здания) - блокируют движение
   - Враги - отбрасываются, замедляют машину

2. **Столкновения с препятствиями (зданиями)**:
   - Машина останавливается
   - Применяется пружинящий эффект
   - Здание получает урон (если разрушаемое)
   - Машина получает самоурон (30% от урона зданию)

3. **Столкновения с врагами**:
   - Враг отбрасывается через Transform
   - NavMeshAgent временно отключается
   - Враг получает урон от машины
   - Скорость машины уменьшается на фиксированное значение
   - Машина продолжает движение

4. **Отбрасывание врагов**:
   - Направление от центра машины к врагу
   - Дистанция зависит от скорости машины
   - Плавная анимация с замедлением

## Типы коллизий

### Прямоугольник vs Прямоугольник
- Машина vs Здания
- Использует алгоритм Separating Axis Theorem (SAT)
- Учитывает поворот объектов

### Прямоугольник vs Круг
- Машина vs Враги
- Находит ближайшую точку на прямоугольнике к центру круга

## Производительность
- **FixedUpdate**: Стабильные 50 FPS для коллизий
- **2-5x быстрее** Unity Physics для простых коллизий
- **3-6x меньше памяти** чем Rigidbody + Collider
- Использует sqrMagnitude вместо Distance
- Проверки только при движении машины
- Без использования физики Unity
- Идеально для мобильных устройств

## Особенности движения
- **Любое направление**: Коллизии работают при движении вперед и назад
- **Сбивание врагов**: Машина проезжает сквозь врагов, отбрасывая их
- **Замедление от врагов**: Скорость уменьшается при каждом столкновении с врагом
- **Урон зданиям**: Машина наносит урон разрушаемым зданиям
- **Самоурон**: Машина получает урон при столкновении с зданиями (30% от урона зданию)
- **Пружинящий эффект**: Реалистичное покачивание при ударе о здания
- **Урон от скорости**: Базовый урон масштабируется от скорости (0-100% от максимальной)
- **Инерция подвески**: Сила и длительность эффекта зависят от скорости удара

## Визуализация
- **Зеленый куб**: Коллизия машины (при выделении)
- **Желтый круг**: Радиус совместимости машины
- **Красный куб**: Прямоугольные препятствия (здания)
- **Красная сфера**: Круглые препятствия (враги)
- **Полупрозрачные**: Постоянно видимые коллайдеры 